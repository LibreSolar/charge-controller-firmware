<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Charger Concepts &mdash; Charge Controller  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Workspace Setup" href="../dev/workspace_setup.html" />
    <link rel="prev" title="Supported Hardware" href="supported_hardware.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #005e83" >

          
          
          <a href="../../index.html" class="icon icon-home">
            Charge Controller
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v21.0

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_hardware.html">Supported Hardware</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Charger Concepts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bus-and-port-structure">Bus and port structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#charger-state-machine">Charger state machine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#standby">0. Standby</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bulk-stage">1. Bulk stage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#topping-stage">2. Topping stage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#equalization-stage">3. Equalization stage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#float-stage">4. Float stage</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/workspace_setup.html">Workspace Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/building_flashing.html">Building and Flashing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev/customization.html">Customization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/customization.html#hardware-specific-changes">Hardware-specific changes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/customization.html#application-firmware-configuration">Application firmware configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../dev/customization.html#change-the-battery-type">Change the battery type</a></li>
<li class="toctree-l3"><a class="reference internal" href="../dev/customization.html#configure-serial-for-thingset-protocol">Configure serial for ThingSet protocol</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../dev/customization.html#custom-functions-separate-c-c-files">Custom functions (separate C/C++ files)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/unit_tests.html">Unit Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/unit_tests.html#conformance-testing">Conformance testing</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../dev/troubleshooting.html">Troubleshoting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/troubleshooting.html#errors-with-stm32l072-mcu-using-openocd">Errors with STM32L072 MCU using OpenOCD</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/bat_charger.html">Battery Charger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/daq.html">Data Acquisition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/data_objects.html">Data Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/dcdc.html">DC/DC converter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/device_status.html">Device Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/half_bridge.html">Half Bridge Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/load.html">Load Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/power_port.html">DC Bus and Power Port</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/pwm_switch.html">PWM Switch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/misc.html">Misc</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/misc.html#data-storage">Data Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/misc.html#hardware">Hardware</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/misc.html#helper">Helper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/misc.html#leds">LEDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/misc.html#setup">Setup</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #005e83" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Charge Controller</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Charger Concepts</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/LibreSolar/charge-controller-firmware/blob/main/docs/src/overview/charger_concepts.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="charger-concepts">
<h1>Charger Concepts<a class="headerlink" href="#charger-concepts" title="Permalink to this heading"></a></h1>
<section id="bus-and-port-structure">
<h2>Bus and port structure<a class="headerlink" href="#bus-and-port-structure" title="Permalink to this heading"></a></h2>
<p>In order to handle multiple different types of charge controllers, the power flow in the charge controller is abstracted using the two base components DC bus and Power Port:</p>
<ul class="simple">
<li><p>A <strong>DC bus</strong>, which is a connection of two or more electrical circuits such that the electric potential at each connection point can be considered equal. This can be achieved either by connecting each participant very close to each other or by using large copper cross-section such that voltage drop introduced by current flow is negligible. The voltage control targets of the bus can only be set by one of the connected ports.</p></li>
<li><p>A <strong>Power port</strong>, which connects a DC bus with an internal or external device or sub-circuit. A port usually contains a current measurement. Its voltage is determined by the DC bus it is connected to. A port can also contain a switching element.</p></li>
</ul>
<p>The following image gives an overview of the maximum set of features for a charge controller currently considered in the firmware. It contains two DC buses: High-voltage side (typically solar panel or wind turbine) and low-voltage side (typically determined by battery voltage). Most of the power ports are connected at the low voltage side (12V or 24V).</p>
<img alt="Charger controller bus and port structure" src="../../_images/charge-controller-structure.svg" /><p>The image also shows the direction of positive current flow.</p>
</section>
<section id="charger-state-machine">
<h2>Charger state machine<a class="headerlink" href="#charger-state-machine" title="Permalink to this heading"></a></h2>
<p>For general information about battery charging, please check out the [battery chapter at learn.libre.solar](<a class="reference external" href="https://learn.libre.solar/system/battery.html#charge-methods">https://learn.libre.solar/system/battery.html#charge-methods</a>).</p>
<p>The charger module in the firmware has the following states:</p>
<section id="standby">
<h3>0. Standby<a class="headerlink" href="#standby" title="Permalink to this heading"></a></h3>
<p>Initial state of the charge controller. If the solar voltage is high enough and the battery is not full, charging in CC mode is started.</p>
</section>
<section id="bulk-stage">
<h3>1. Bulk stage<a class="headerlink" href="#bulk-stage" title="Permalink to this heading"></a></h3>
<p>This first charging stage adds about 70 percent of the stored energy. The battery is charged with a constant current (CC), typically the maximum current the charger can supply. In case of a solar charge controller, this is where the Maximum Power Point Tracking (MPPT) takes place. As a result, the terminal voltage increases until the peak charge voltage limit is reached and topping phase is entered.</p>
</section>
<section id="topping-stage">
<h3>2. Topping stage<a class="headerlink" href="#topping-stage" title="Permalink to this heading"></a></h3>
<p>During the topping (sometimes also called boost or absorption) the remaining 30 percent of the energy is continued being charged at a constant voltage (CV) while gradually decreasing the charge current until the battery is fully charged.</p>
</section>
<section id="equalization-stage">
<h3>3. Equalization stage<a class="headerlink" href="#equalization-stage" title="Permalink to this heading"></a></h3>
<p>An additional equalization charging is beneficial for flooded lead-acid batteries only. It can be considered as a periodic controlled overcharge that brings the cells to the same charge level and removes the sulphation by increasing the voltage to a higher value than the peak charge voltage limit. The current during equlization is controlled at a very low value.</p>
</section>
<section id="float-stage">
<h3>4. Float stage<a class="headerlink" href="#float-stage" title="Permalink to this heading"></a></h3>
<p>The float or trickle charging stage is the final phase upon the completion of the absorption or equalization phase which maintains the battery at full charge. During this stage, the charge voltage is reduced and held constant. The current reduces to a very low value.</p>
<img alt="Flow-chart of the MPPT charge controller state machine" src="../../_images/charging-stages.png" />
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="supported_hardware.html" class="btn btn-neutral float-left" title="Supported Hardware" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../dev/workspace_setup.html" class="btn btn-neutral float-right" title="Workspace Setup" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 The Libre Solar Project.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>